{"version":3,"sources":["modules/school/structure.js","modules/school/forms/ClassModal.js","modules/school/forms/Schedule.js","modules/school/components/Calendar.jsx","modules/school/components/index.js","modules/school/translations.js","modules/school/Client.js"],"names":["structures","Course","fields","name","type","Fields","STRING","Class","REFERENCE","entity","DATE","INTEGER","Attendance","BOOLEAN","ClassModal","args","Object","assign","this","elements","id","Elements","MODAL","fullWidth","maxWidth","open","onClose","GROUP","div","style","display","LABEL","title","tag","width","BUTTON","onClick","close","marginLeft","delete","GRID","getElement","find","f","onChange","change","addAttendance","marginBottom","cols","height","ConfirmDialog","form","aChangeTimeouts","attendanceUuids","params","a","content","classModal","rows","uuid","app","get","classData","response","setValues","loadAttendances","undefined","start","end","tutor","value","course","durationMin","Math","ceil","getTime","save","changeTimeout","clearTimeout","setTimeout","getValues","put","body","saved","load","confirmDialog","confirm","data","rowId","random","row","SELECT","getOptions","q","clientQuery","saveAttendance","client","CHECKBOX","marginTop","attend","delAttendance","push","sort","b","query","Client","where","$or","$like","phone","address","map","item","class","classUuid","forEach","att","splice","findIndex","i","Schedule","onSelectSlot","newClass","onRangeChange","events","onSelectEvent","event","onEventResize","onEventDrop","moment","startOf","toDate","endOf","range","length","$lte","$gte","classes","add","calendar","Form","localizer","momentLocalizer","BigCalendarDND","withDragAndDrop","BigCalendar","containerStyle","messages","date","time","allDay","week","work_week","day","month","previous","next","yesterday","tomorrow","today","agenda","noEventsInRange","showMore","e","Component","Calendar","props","defaultView","resizable","selectable","init","addToMenu","forms","menu","unshift","setMenu","constructor","components","Components","translations","ru"],"mappings":"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","file":"static/js/4.c99a082c.chunk.js","sourcesContent":["import Fields from 'katejs/lib/fields';\n\n//\n// Занятие - class\n// Направление - course\n// Абонемент - subscription\n//\n\nconst Course = {\n  fields: [\n    {\n      name: 'title',\n      type: Fields.STRING,\n    },\n  ],\n};\n\nconst Class = {\n  fields: [\n    {\n      name: 'title',\n      type: Fields.STRING,\n    },\n    {\n      name: 'course',\n      type: Fields.REFERENCE,\n      entity: 'Course',\n    },\n    {\n      name: 'tutor',\n      type: Fields.REFERENCE,\n      entity: 'User',\n    },\n    {\n      name: 'start',\n      type: Fields.DATE,\n    },\n    {\n      name: 'durationMin',\n      type: Fields.INTEGER,\n    },\n  ],\n};\n\nconst Attendance = {\n  fields: [\n    {\n      name: 'client',\n      type: Fields.REFERENCE,\n      entity: 'Client',\n    },\n    {\n      name: 'class',\n      type: Fields.REFERENCE,\n      entity: 'Class',\n    },\n    {\n      name: 'attend',\n      type: Fields.BOOLEAN,\n    },\n  ],\n};\n\nexport const structures = {\n  Course,\n  Class,\n  Attendance,\n};\n\nexport const clientField = {\n  name: 'client',\n  type: Fields.REFERENCE,\n  entity: 'Client',\n};\n","import { Elements, getElement, ConfirmDialog } from 'katejs/lib/client';\r\nimport { clientField, structures } from '../structure';\r\n\r\nconst Class = structures.Class;\r\n\r\nexport default class ClassModal {\r\n  constructor(args) {\r\n    Object.assign(this, args);\r\n\r\n    this.elements = [\r\n      {\r\n        id: 'classModal',\r\n        type: Elements.MODAL,\r\n        fullWidth: true,\r\n        maxWidth: 'xl',\r\n        open: false,\r\n        onClose: null,\r\n        elements: [\r\n          {\r\n            type: Elements.GROUP,\r\n            div: true,\r\n            style: { display: 'flex' },\r\n            elements: [\r\n              {\r\n                type: Elements.LABEL,\r\n                title: 'Class',\r\n                tag: 'h4',\r\n                style: { width: 200 },\r\n              },\r\n              // {\r\n              //   type: Elements.BUTTON,\r\n              //   title: 'Save',\r\n              //   onClick: () => this.save(),\r\n              // },\r\n              {\r\n                type: Elements.BUTTON,\r\n                title: 'Close',\r\n                onClick: () => this.close(),\r\n              },\r\n              {\r\n                type: Elements.BUTTON,\r\n                title: 'Delete',\r\n                style: { marginLeft: 50 },\r\n                onClick: () => this.delete(),\r\n              },\r\n            ],\r\n          },\r\n          {\r\n            type: Elements.GRID,\r\n            elements: [\r\n              {\r\n                ...getElement(Class.fields.find(f => f.name === 'tutor'), this),\r\n                onChange: () => this.change(),\r\n              },\r\n              {\r\n                ...getElement(Class.fields.find(f => f.name === 'course'), this),\r\n                onChange: () => this.change(),\r\n              },\r\n              {\r\n                ...getElement(Class.fields.find(f => f.name === 'start')),\r\n                title: 'Start',\r\n                onChange: () => this.change(),\r\n              },\r\n              {\r\n                ...getElement(Class.fields.find(f => f.name === 'durationMin')),\r\n                title: 'Duration min',\r\n                onChange: () => this.change(),\r\n              },\r\n            ],\r\n          },\r\n          {\r\n            type: Elements.BUTTON,\r\n            title: 'Добавить посещение',\r\n            onClick: () => this.addAttendance(),\r\n            style: { marginBottom: 20 },\r\n          },\r\n          {\r\n            type: Elements.GRID,\r\n            id: 'rowsTitle',\r\n            elements: [\r\n              {\r\n                type: Elements.LABEL,\r\n                title: 'Клиент',\r\n                tag: 'h4',\r\n                cols: 4,\r\n              },\r\n              {\r\n                type: Elements.LABEL,\r\n                title: 'Посетил',\r\n                tag: 'h4',\r\n                cols: 1,\r\n              },\r\n            ],\r\n          },\r\n          {\r\n            type: Elements.GROUP,\r\n            id: 'rows',\r\n            elements: [],\r\n          },\r\n          {\r\n            id: 'spacer',\r\n            type: Elements.LABEL,\r\n            tag: 'p',\r\n            title: ' ',\r\n            style: { height: 300 },\r\n          },\r\n        ],\r\n      },\r\n      ConfirmDialog({ form: this.form, id: 'confirmDialog' }),\r\n    ];\r\n\r\n    this.aChangeTimeouts = {};\r\n    this.attendanceUuids = {};\r\n  }\r\n  async open(params) {\r\n    this.content.classModal.open = true;\r\n    this.content.rows.elements = [];\r\n\r\n    // existing\r\n    if (params.uuid) {\r\n      this.uuid = params.uuid;\r\n      const { response: classData } = await this.app.Class.get({ uuid: params.uuid });\r\n      this.form.setValues(classData);\r\n      this.loadAttendances();\r\n    } else {\r\n      // new\r\n      this.uuid = undefined;\r\n      const { start, end } = params;\r\n      this.content.tutor.value = null;\r\n      this.content.course.value = null;\r\n      this.content.start.value = start;\r\n      this.content.durationMin.value = Math.ceil( (end.getTime() - start.getTime()) / (1000 * 60) );\r\n      this.save();\r\n    }\r\n  }\r\n\r\n  change() {\r\n    if (this.changeTimeout) {\r\n      clearTimeout(this.changeTimeout);\r\n      this.changeTimeout = undefined;\r\n    }\r\n    this.changeTimeout = setTimeout(() => {\r\n      this.save();\r\n    }, 500);\r\n  }\r\n\r\n  async save() {\r\n    const { tutor, course, start, durationMin } = this.form.getValues();\r\n    const { response: saved } = await this.app.Class.put({ uuid: this.uuid, body: { tutor, course, start, durationMin } });\r\n    this.uuid = saved.uuid;\r\n  }\r\n\r\n  close() {\r\n    this.load();\r\n    this.content.classModal.open = false;\r\n  }\r\n\r\n  async delete() {\r\n    if (!await this.content.confirmDialog.confirm({ title: 'Are you sure?' })) return;\r\n    await this.app.Class.delete({ uuid: this.uuid });\r\n    this.content.classModal.open = false;\r\n    this.load();\r\n  }\r\n\r\n  addAttendance(data = {}) {\r\n    const rowId = Math.ceil(Math.random() * 10000);\r\n    const row = {\r\n      id: `row${rowId}`,\r\n      type: Elements.GRID,\r\n      elements: [\r\n        {\r\n          id: `client${rowId}`,\r\n          type: Elements.SELECT,\r\n          getOptions: (q) => this.clientQuery(),\r\n          title: '',\r\n          cols: 4,\r\n          onChange: () => this.saveAttendance(rowId),\r\n          value: data.client,\r\n        },\r\n        {\r\n          id: `attend${rowId}`,\r\n          type: Elements.CHECKBOX,\r\n          cols: 1,\r\n          onChange: () => this.saveAttendance(rowId),\r\n          style: { marginTop: 10 },\r\n          value: data.attend,\r\n        },\r\n        {\r\n          type: Elements.BUTTON,\r\n          title: 'X',\r\n          onClick: () => this.delAttendance(rowId),\r\n          style: { marginTop: 20 },\r\n        },\r\n      ],\r\n    };\r\n    if (data) {\r\n      this.attendanceUuids[rowId] = data.uuid;\r\n    }\r\n    this.content.rows.elements.push(row);\r\n    this.content.rows.elements.sort((a,b) => a.elements[0].value?.title > b.elements[0].value?.title ? 1 : a.elements[0].value?.title < b.elements[0].value?.title ? -1 : 0);\r\n    this.content.rows.elements = [...this.content.rows.elements];\r\n  }\r\n\r\n  async clientQuery(query) {\r\n    const { response } = await this.app.Client.query({\r\n      where: {\r\n        $or: [\r\n          { title: { $like: `%${query || ''}%` } },\r\n          { phone: { $like: `%${query || ''}%` } },\r\n          { address: { $like: `%${query || ''}%` } },\r\n        ],\r\n      },\r\n    });\r\n    return (response || []).map(item => ({ ...item, title: `${item.title} (${item.phone || ''}${(item.phone && item.address) ? ',' : ''}${item.address || ''})` }));\r\n  }\r\n\r\n  async saveAttendance(rowId) {\r\n    if (this.aChangeTimeouts[rowId]) {\r\n      clearTimeout(this.aChangeTimeouts[rowId]);\r\n      this.aChangeTimeouts[rowId] = undefined;\r\n    }\r\n    const body = {\r\n      client: this.content[`client${rowId}`].value,\r\n      attend: this.content[`attend${rowId}`].value,\r\n      class: { uuid: this.uuid },\r\n    };\r\n    const uuid = this.attendanceUuids[rowId];\r\n    setTimeout(async () => {\r\n      const { response } = await this.app.Attendance.put({ uuid, body: body });\r\n      this.attendanceUuids[rowId] = response.uuid;\r\n    }, 500);\r\n  }\r\n\r\n  async loadAttendances() {\r\n    const { response } = await this.app.Attendance.query({\r\n      where: {\r\n        classUuid: this.uuid,\r\n      },\r\n    });\r\n    response.forEach(att => this.addAttendance(att));\r\n  }\r\n\r\n  async delAttendance(rowId) {\r\n    await this.app.Attendance.delete({ uuid: this.attendanceUuids[rowId] });\r\n    const rows = this.content.rows.elements;\r\n    rows.splice(rows.findIndex(i => i.id === `row${rowId}`), 1);\r\n    this.content.rows.elements = [...rows];\r\n  }\r\n}\r\n","import moment from 'moment';\r\nimport { Form, Elements } from 'katejs/lib/client';\r\nimport ClassModal from './ClassModal';\r\n\r\n\r\nexport default class Schedule extends Form {\r\n  static title = 'Schedule';\r\n\r\n  constructor(args) {\r\n    super(args);\r\n\r\n    this.classModal = new ClassModal({\r\n      content: this.content,\r\n      app: this.app,\r\n      form: this,\r\n      load: () => this.load(),\r\n    });\r\n\r\n    this.elements = [\r\n      {\r\n        id: 'calendar',\r\n        type: 'Calendar',\r\n        onSelectSlot: (params) => this.newClass(params),\r\n        onRangeChange: (params) => this.onRangeChange(params),\r\n        // views:['week','day','agenda'],\r\n        events: [],\r\n        onSelectEvent: (event) => this.onSelectEvent(event),\r\n        onEventResize: (data) => this.onEventResize(data),\r\n        onEventDrop: (data) => this.onEventResize(data),\r\n      },\r\n      ...this.classModal.elements,\r\n    ];\r\n    this.start = moment().startOf('week').toDate();\r\n    this.end = moment().endOf('week').toDate();\r\n    this.load();\r\n  }\r\n\r\n  newClass(params) {\r\n    this.classModal.open(params);\r\n  }\r\n\r\n  onRangeChange(range) {\r\n    if (range.start) {\r\n      this.start = moment(range.start).startOf('day').toDate();\r\n      this.end = moment(range.end).endOf('day').toDate();\r\n    } else {\r\n      this.start = moment(range[0]).startOf('day').toDate();\r\n      this.end = moment(range[range.length - 1]).endOf('day').toDate();\r\n    }\r\n    this.load();\r\n  }\r\n\r\n  async load() {\r\n    const { response: classes } = await this.app.Class.query({\r\n      where: {\r\n        start: {\r\n          $lte: this.end,\r\n          $gte: this.start,\r\n        }\r\n      },\r\n    });\r\n    const events = classes.map((event) => ({\r\n      start: moment(event.start).toDate(),\r\n      end: moment(event.start).add(event.durationMin, 'minutes').toDate(),\r\n      uuid: event.uuid,\r\n      title: `${event.course ? event.course.title : 'Занятие'} (${event.tutor ? event.tutor.title : ''})`,\r\n    }));\r\n    this.content.calendar.events = events;\r\n  }\r\n\r\n  onSelectEvent(event) {\r\n    this.classModal.open({ uuid: event.uuid });\r\n  }\r\n\r\n  async onEventResize(data) {\r\n    const { start, end, event } = data;\r\n    event.start = start;\r\n    event.end = end;\r\n    this.content.calendar.events = [...this.content.calendar.events];\r\n    await this.app.Class.put({\r\n      uuid: event.uuid,\r\n      body: {\r\n        start,\r\n        durationMin: Math.ceil( (end.getTime() - start.getTime()) / (1000 * 60) ),\r\n      },\r\n    });\r\n    await this.load();\r\n  }\r\n}\r\n","import React, { Component } from 'react';\r\nimport moment from 'moment';\r\nimport { Calendar as BigCalendar, momentLocalizer } from 'react-big-calendar';\r\nimport 'react-big-calendar/lib/css/react-big-calendar.css';\r\nimport 'react-big-calendar/lib/addons/dragAndDrop/styles.scss'\r\nimport withDragAndDrop from 'react-big-calendar/lib/addons/dragAndDrop';\r\n\r\nimport './Calendar.scss';\r\n\r\nconst localizer = momentLocalizer(moment);\r\nconst BigCalendarDND = withDragAndDrop(BigCalendar);\r\n\r\nconst containerStyle = {\r\n  height: '80vh',\r\n};\r\n\r\nconst messages = {\r\n  date: 'Дата',\r\n  time: 'Время',\r\n  event: 'Занятие',\r\n  allDay: 'Целый день',\r\n  week: 'Неделя',\r\n  work_week: 'Рабочая неделя',\r\n  day: 'День',\r\n  month: 'Месяц',\r\n  previous: 'Назад',\r\n  next: 'Вперед',\r\n  yesterday: 'Вчера',\r\n  tomorrow: 'Завтра',\r\n  today: 'Сегодня',\r\n  agenda: 'Агенда',\r\n  noEventsInRange: 'Нет занятий в выбранном периода',\r\n  showMore: e => `+${e} еще`,\r\n};\r\n\r\nexport default (props) => (\r\n  <div style={containerStyle}>\r\n    <BigCalendarDND\r\n      defaultView='week'\r\n      resizable\r\n      selectable\r\n      localizer={localizer}\r\n      messages={messages}\r\n      {...props}\r\n      events={props.events || []}\r\n    />\r\n  </div>\r\n);\r\n\r\nclass Calendar1 extends Component {\r\n  id = 2;\r\n  state = {\r\n    events: [\r\n      {\r\n        id: 1,\r\n        start: moment().toDate(),\r\n        end: moment().add(2, 'hour').toDate(),\r\n        title: 'Some title',\r\n      },\r\n    ],\r\n  };\r\n\r\n  onEventResize = (data) => {\r\n    const { start, end, event } = data;\r\n    event.start = start;\r\n    event.end = end;\r\n\r\n    this.setState((state) => {\r\n      return { events: [...state.events] };\r\n    });\r\n  };\r\n\r\n  onEventDrop = (data) => {\r\n    const { start, end, event } = data;\r\n    event.start = start;\r\n    event.end = end;\r\n\r\n    this.setState((state) => {\r\n      return { events: [...state.events] };\r\n    });\r\n  };\r\n\r\n  handleSelect = ({ start, end }) => {\r\n    const title = window.prompt('New Event name')\r\n    if (title) {\r\n      this.setState({\r\n        events: [\r\n          ...this.state.events,\r\n          {\r\n            id: ++this.id,\r\n            start,\r\n            end,\r\n            title,\r\n          },\r\n        ],\r\n      });\r\n    }\r\n  };\r\n\r\n  eventPropGetter = (event, start, end, isSelected) => {\r\n    const newStyle = {\r\n      backgroundColor: isSelected ? '#08b2c3' : '#088596',\r\n      borderColor: '#088596',\r\n    };\r\n    return {\r\n      style: newStyle,\r\n    };\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <div style={containerStyle}>\r\n        <BigCalendarDND\r\n          defaultDate={moment().toDate()}\r\n          defaultView='week'\r\n          events={this.state.events}\r\n          onEventDrop={this.onEventDrop}\r\n          onEventResize={this.onEventResize}\r\n          resizable\r\n          selectable\r\n          localizer={localizer}\r\n          messages={messages}\r\n          onSelectEvent={event => console.log(event.title)}\r\n          onSelectSlot={this.handleSelect}\r\n          eventPropGetter={this.eventPropGetter}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import Calendar from \"./Calendar\";\r\n\r\nexport default {\r\n  Calendar,\r\n};\r\n\r\n","export default {\r\n  ru: {\r\n    'Schedule': 'Расписание',\r\n    'Courses': 'Курсы',\r\n    'Course': 'Курс',\r\n    'Tutor': 'Преподаватель',\r\n    'Class': 'Занятие',\r\n    'Classs': 'Занятия',\r\n    'Attendances': 'Посещения',\r\n    'Attendance': 'Посещение',\r\n    'Duration min': 'Длительность, мин',\r\n  },\r\n}\r\n","import Schedule from './forms/Schedule';\r\nimport Components from './components';\r\n\r\nimport translations from './translations';\r\nimport { structures } from './structure';\r\n\r\nexport default (app) => {\r\n  app.init({ structures, addToMenu: true });\r\n\r\n  app.forms.Schedule = Schedule;\r\n  app.menu.unshift({\r\n    title: 'Schedule',\r\n    form: 'Schedule',\r\n  });\r\n  app.setMenu(app.menu);\r\n\r\n  app.constructor.components = { ...app.constructor.components, ...Components };\r\n\r\n  // в конструкторе приложения замыкается объект translations.ru - нельзя его переопределять.\r\n  Object.assign(app.translations.ru, translations.ru);\r\n}\r\n"],"sourceRoot":""}